function e(e){return e&&e.__esModule?e.default:e}var t,i={};(t=function(){function e(e){return n.appendChild(e.dom),e}function i(e){for(var t=0;t<n.children.length;t++)n.children[t].style.display=t===e?"block":"none";o=e}var o=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(e){e.preventDefault(),i(++o%n.children.length)},!1);var l=(performance||Date).now(),a=l,s=0,r=e(new t.Panel("FPS","#0ff","#002")),h=e(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=e(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:e,showPanel:i,begin:function(){l=(performance||Date).now()},end:function(){s++;var e=(performance||Date).now();if(h.update(e-l,200),e>a+1e3&&(r.update(1e3*s/(e-a),100),a=e,s=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){l=this.end()},domElement:n,setMode:i}}).Panel=function(e,t,i){var o=1/0,n=0,l=Math.round,a=l(window.devicePixelRatio||1),s=80*a,r=48*a,h=3*a,c=2*a,d=3*a,f=15*a,m=74*a,y=30*a,u=document.createElement("canvas");u.width=s,u.height=r,u.style.cssText="width:80px;height:48px";var p=u.getContext("2d");return p.font="bold "+9*a+"px Helvetica,Arial,sans-serif",p.textBaseline="top",p.fillStyle=i,p.fillRect(0,0,s,r),p.fillStyle=t,p.fillText(e,h,c),p.fillRect(d,f,m,y),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(d,f,m,y),{dom:u,update:function(r,w){o=Math.min(o,r),n=Math.max(n,r),p.fillStyle=i,p.globalAlpha=1,p.fillRect(0,0,s,f),p.fillStyle=t,p.fillText(l(r)+" "+e+" ("+l(o)+"-"+l(n)+")",h,c),p.drawImage(u,d+a,f,m-a,y,d,f,m-a,y),p.fillRect(d+m-a,f,a,y),p.fillStyle=i,p.globalAlpha=.9,p.fillRect(d+m-a,f,a,l((1-r/w)*y))}}},i=t;const o=[[[1,1],[1,1]],[[1],[1],[1],[1]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]],[[1,0],[1,0],[1,1]],[[0,1],[0,1],[1,1]],[[1,1,1],[0,1,0]]];class n{x=0;y=0;shape;board;startPosition;constructor(e,t){this.board=e,this.startPosition=t,this.restart()}movePieceDown(){this.isPositionValid(this.x,this.y+1,this.shape)?this.y++:this.solidifyPiece()}movePieceRight(){this.isPositionValid(this.x+1,this.y,this.shape)&&this.x++}movePieceLeft(){this.isPositionValid(this.x-1,this.y,this.shape)&&this.x--}rotatePiece(){let e=this.shape[0].map((e,t)=>this.shape.map(e=>e[t]).reverse());this.isPositionValid(this.x,this.y,e)&&(this.shape=e)}isPositionValid(e,t,i){return!(e<0)&&!(e+i[0].length>30)&&!(t+i.length>20)&&!i.some((i,o)=>i.some((i,n)=>!!i&&this.board[t+o][e+n]))}solidifyPiece(){let e=this.x,t=this.y;this.shape.forEach((i,o)=>{i.forEach((i,n)=>{if(!i)return!1;this.board[t+o][e+n]=1})}),this.restart()}restart(){this.x=this.startPosition.x,this.y=this.startPosition.y,this.shape=o[Math.floor(Math.random()*o.length)]}}var l={};l=import.meta.resolve("PSiwf");const a=new(e(i));a.dom.style.left="unset",a.dom.style.right="0",a.showPanel(0),document.body.appendChild(a.dom);const s=document.querySelector("canvas"),r=s.getContext("2d"),h=Array.from({length:20},()=>Array(30).fill(0)),c=new n(h,{x:2,y:0}),d=new n(h,{x:25,y:0});s.width=600,s.height=400,r.scale(20,20);let f=0;function m(e){r.fillStyle="red",e.shape.forEach((t,i)=>{t.forEach((t,o)=>{t&&r.fillRect(e.x+o,e.y+i,1,1)})})}document.querySelector("#start").addEventListener("click",function(){document.querySelector("#start").hidden=!0,new Audio(e(l)).play(),function e(t){a.begin(),r.fillStyle="#000",r.fillRect(0,0,s.width,s.height),r.fillStyle="yellow",h.forEach((e,t)=>{e.forEach((e,i)=>{1===e&&r.fillRect(i,t,1,1)})}),m(c),m(d),t>f&&(f=t+400,c.movePieceDown(),d.movePieceDown(),function(){for(let e=h.length-1;e>=0;e--)h[e].every(e=>1===e)&&(h.splice(e,1),h.unshift(Array(30).fill(0)),e++)}()),a.end(),window.requestAnimationFrame(e)}(),document.addEventListener("keydown",e=>{"ArrowDown"===e.key?d.movePieceDown():"ArrowLeft"===e.key?d.movePieceLeft():"ArrowRight"===e.key?d.movePieceRight():"ArrowUp"===e.key?d.rotatePiece():"s"===e.key?c.movePieceDown():"a"===e.key?c.movePieceLeft():"d"===e.key?c.movePieceRight():"w"===e.key&&c.rotatePiece()})});
//# sourceMappingURL=bitetris.af7dccb2.js.map
