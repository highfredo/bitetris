(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))t(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&t(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(i){if(i.ep)return;i.ep=!0;const r=s(i);fetch(i.href,r)}})();function k(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var v={exports:{}},L=v.exports,b;function C(){return b||(b=1,function(h,e){(function(s,t){h.exports=t()})(L,function(){var s=function(){function t(c){return n.appendChild(c.dom),c}function i(c){for(var l=0;l<n.children.length;l++)n.children[l].style.display=l===c?"block":"none";r=c}var r=0,n=document.createElement("div");n.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",n.addEventListener("click",function(c){c.preventDefault(),i(++r%n.children.length)},!1);var f=(performance||Date).now(),d=f,o=0,u=t(new s.Panel("FPS","#0ff","#002")),y=t(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=t(new s.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:n,addPanel:t,showPanel:i,begin:function(){f=(performance||Date).now()},end:function(){o++;var c=(performance||Date).now();if(y.update(c-f,200),c>d+1e3&&(u.update(1e3*o/(c-d),100),d=c,o=0,m)){var l=performance.memory;m.update(l.usedJSHeapSize/1048576,l.jsHeapSizeLimit/1048576)}return c},update:function(){f=this.end()},domElement:n,setMode:i}};return s.Panel=function(t,i,r){var n=1/0,f=0,d=Math.round,o=d(window.devicePixelRatio||1),u=80*o,y=48*o,m=3*o,c=2*o,l=3*o,p=15*o,g=74*o,w=30*o,P=document.createElement("canvas");P.width=u,P.height=y,P.style.cssText="width:80px;height:48px";var a=P.getContext("2d");return a.font="bold "+9*o+"px Helvetica,Arial,sans-serif",a.textBaseline="top",a.fillStyle=r,a.fillRect(0,0,u,y),a.fillStyle=i,a.fillText(t,m,c),a.fillRect(l,p,g,w),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(l,p,g,w),{dom:P,update:function(x,T){n=Math.min(n,x),f=Math.max(f,x),a.fillStyle=r,a.globalAlpha=1,a.fillRect(0,0,u,p),a.fillStyle=i,a.fillText(d(x)+" "+t+" ("+d(n)+"-"+d(f)+")",m,c),a.drawImage(P,l+o,p,g-o,w,l,p,g-o,w),a.fillRect(l+g-o,p,o,w),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(l+g-o,p,o,d((1-x/T)*w))}}},s})}(v)),v.exports}var D=C();const H=k(D),M="/bitetris/assets/tetris-3uvX0fkN.mp3",O=[[1,1],[1,1]],I=[[1],[1],[1],[1]],z=[[0,1,1],[1,1,0]],B=[[1,1,0],[0,1,1]],q=[[1,0],[1,0],[1,1]],V=[[0,1],[0,1],[1,1]],N=[[1,1,1],[0,1,0]],A=[O,I,z,B,q,V,N];class R{constructor(e,s){this.game=e,this.startPosition=s,this.x=0,this.y=0,this.restart()}movePieceDown(){this.isPositionValid(this.x,this.y+1,this.shape)?this.y++:this.solidifyPiece()}movePieceRight(){this.isPositionValid(this.x+1,this.y,this.shape)&&this.x++}movePieceLeft(){this.isPositionValid(this.x-1,this.y,this.shape)&&this.x--}rotatePiece(){const e=this.shape[0].map((s,t)=>this.shape.map(i=>i[t]).reverse());this.isPositionValid(this.x,this.y,e)&&(this.shape=e)}isPositionValid(e,s,t){var r;if(e<0||e+t[0].length>this.game.board_width||s+t.length>this.game.board_height)return!1;const i=((r=this.game.pieces)==null?void 0:r.filter(n=>n!==this))||[];return!t.some((n,f)=>n.some((d,o)=>d?this.game.board[s+f][e+o]||i.some(u=>u.shape.some((y,m)=>y.some((c,l)=>c&&u.x+l===e+o&&u.y+m===s+f))):!1))}solidifyPiece(){const e=this.x,s=this.y;this.shape.forEach((t,i)=>{t.forEach((r,n)=>{if(!r)return!1;this.game.board[s+i][e+n]=1})}),this.restart()}restart(){this.x=this.startPosition,this.y=0,this.shape=A[Math.floor(Math.random()*A.length)]}}function F(h,e){return Array.from({length:h},()=>new Array(e).fill(0))}class j{constructor(e,s){this.board_width=e,this.board_height=s,this.board=F(e,s),this.pieces=[new R(this,2),new R(this,e-5)]}executeTick(){this.pieces.forEach(e=>e.movePieceDown()),this.clearCompletedRows()}clearCompletedRows(){for(let e=this.board.length-1;e>=0;e--)this.board[e].every(s=>s===1)&&(this.board.splice(e,1),this.board.unshift(Array(this.board_width).fill(0)),e++)}}const G=400,E=30,S=20;class J{constructor(e){var s;if(this.nextTickTime=0,this.game=new j(E,S),this.canvas=document.querySelector(e),this.ctx=(s=this.canvas)==null?void 0:s.getContext("2d"),!this.ctx){const t=`Canvas context not found for selector: ${e}`;throw alert(t),new Error(t)}this.resizeCanvas(),this.stats=new H,this.stats.dom.style.left="unset",this.stats.dom.style.right="0",this.stats.showPanel(0),document.body.appendChild(this.stats.dom),document.addEventListener("keydown",t=>{t.key==="ArrowDown"?this.game.pieces[1].movePieceDown():t.key==="ArrowLeft"?this.game.pieces[1].movePieceLeft():t.key==="ArrowRight"?this.game.pieces[1].movePieceRight():t.key==="ArrowUp"?this.game.pieces[1].rotatePiece():t.key==="s"?this.game.pieces[0].movePieceDown():t.key==="a"?this.game.pieces[0].movePieceLeft():t.key==="d"?this.game.pieces[0].movePieceRight():t.key==="w"&&this.game.pieces[0].rotatePiece()}),this.update(0)}update(e){this.stats.begin(),this.draw(),e>this.nextTickTime&&(this.nextTickTime=e+G,this.game.executeTick()),this.stats.end(),window.requestAnimationFrame(s=>this.update(s))}draw(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(this.game.board),this.game.pieces.forEach(e=>this.drawPiece(e))}resizeCanvas(){const e=window.innerWidth,s=window.innerHeight,t=Math.min(e/E,s/S),i=Math.floor(t);this.canvas.width=i*E,this.canvas.height=i*S,this.ctx.scale(i,i)}drawBoard(e){this.ctx.fillStyle="yellow",e.forEach((s,t)=>{s.forEach((i,r)=>{i===1&&this.ctx.fillRect(r,t,1,1)})})}drawPiece(e){this.ctx.fillStyle="red",e.shape.forEach((s,t)=>{s.forEach((i,r)=>{i&&this.ctx.fillRect(e.x+r,e.y+t,1,1)})})}}const _=document.querySelector("#start");_.addEventListener("click",()=>{_.hidden=!0;const h=new Audio(M);h.loop=!0,h.play();const e=new J("canvas");addEventListener("resize",()=>{e.resizeCanvas()})});
