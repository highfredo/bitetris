(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const o of t)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&r(a)}).observe(document,{childList:!0,subtree:!0});function s(t){const o={};return t.integrity&&(o.integrity=t.integrity),t.referrerPolicy&&(o.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?o.credentials="include":t.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(t){if(t.ep)return;t.ep=!0;const o=s(t);fetch(t.href,o)}})();function M(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var A={exports:{}},C=A.exports,k;function q(){return k||(k=1,function(i,e){(function(s,r){i.exports=r()})(C,function(){var s=function(){function r(l){return a.appendChild(l.dom),l}function t(l){for(var f=0;f<a.children.length;f++)a.children[f].style.display=f===l?"block":"none";o=l}var o=0,a=document.createElement("div");a.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",a.addEventListener("click",function(l){l.preventDefault(),t(++o%a.children.length)},!1);var u=(performance||Date).now(),h=u,n=0,p=r(new s.Panel("FPS","#0ff","#002")),w=r(new s.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=r(new s.Panel("MB","#f08","#201"));return t(0),{REVISION:16,dom:a,addPanel:r,showPanel:t,begin:function(){u=(performance||Date).now()},end:function(){n++;var l=(performance||Date).now();if(w.update(l-u,200),l>h+1e3&&(p.update(1e3*n/(l-h),100),h=l,n=0,m)){var f=performance.memory;m.update(f.usedJSHeapSize/1048576,f.jsHeapSizeLimit/1048576)}return l},update:function(){u=this.end()},domElement:a,setMode:t}};return s.Panel=function(r,t,o){var a=1/0,u=0,h=Math.round,n=h(window.devicePixelRatio||1),p=80*n,w=48*n,m=3*n,l=2*n,f=3*n,y=15*n,g=74*n,v=30*n,S=document.createElement("canvas");S.width=p,S.height=w,S.style.cssText="width:80px;height:48px";var c=S.getContext("2d");return c.font="bold "+9*n+"px Helvetica,Arial,sans-serif",c.textBaseline="top",c.fillStyle=o,c.fillRect(0,0,p,w),c.fillStyle=t,c.fillText(r,m,l),c.fillRect(f,y,g,v),c.fillStyle=o,c.globalAlpha=.9,c.fillRect(f,y,g,v),{dom:S,update:function(b,I){a=Math.min(a,b),u=Math.max(u,b),c.fillStyle=o,c.globalAlpha=1,c.fillRect(0,0,p,y),c.fillStyle=t,c.fillText(h(b)+" "+r+" ("+h(a)+"-"+h(u)+")",m,l),c.drawImage(S,f+n,y,g-n,v,f,y,g-n,v),c.fillRect(f+g-n,y,n,v),c.fillStyle=o,c.globalAlpha=.9,c.fillRect(f+g-n,y,n,h((1-b/I)*v))}}},s})}(A)),A.exports}var B=q();const V=M(B),N="/bitetris/assets/tetris-3uvX0fkN.mp3",R=20,_=30,L=20,F=400,j=[[1,1],[1,1]],z=[[1],[1],[1],[1]],G=[[0,1,1],[1,1,0]],K=[[1,1,0],[0,1,1]],J=[[1,0],[1,0],[1,1]],U=[[0,1],[0,1],[1,1]],Z=[[1,1,1],[0,1,0]],D=[j,z,G,K,J,U,Z];class T{constructor(e,s){this.game=e,this.startPosition=s,this.x=0,this.y=0,this.restart()}movePieceDown(){this.isPositionValid(this.x,this.y+1,this.shape)?this.y++:this.solidifyPiece()}movePieceRight(){this.isPositionValid(this.x+1,this.y,this.shape)&&this.x++}movePieceLeft(){this.isPositionValid(this.x-1,this.y,this.shape)&&this.x--}rotatePiece(){const e=this.shape[0].map((s,r)=>this.shape.map(t=>t[r]).reverse());this.isPositionValid(this.x,this.y,e)&&(this.shape=e)}isPositionValid(e,s,r){if(e<0||e+r[0].length>_||s+r.length>L)return!1;const t=this.game.pieces.filter(o=>o!==this);return!r.some((o,a)=>o.some((u,h)=>u?this.game.board[s+a][e+h]||t.some(n=>n.shape.some((p,w)=>p.some((m,l)=>m&&n.x+l===e+h&&n.y+w===s+a))):!1))}solidifyPiece(){const e=this.x,s=this.y;this.shape.forEach((r,t)=>{r.forEach((o,a)=>{if(!o)return!1;this.game.board[s+t][e+a]=1})}),this.restart()}restart(){this.x=this.startPosition,this.y=0,this.shape=D[Math.floor(Math.random()*D.length)]}}function W(i,e){return Array.from({length:i},()=>new Array(e).fill(0))}class X{constructor(e,s){this.board_width=e,this.board_height=s,this.board=W(e,s),this.pieces=[new T(this,2),new T(this,e-5)]}executeTick(){this.pieces.forEach(e=>e.movePieceDown()),this.clearCompletedRows()}clearCompletedRows(){for(let e=this.board.length-1;e>=0;e--)this.board[e].every(s=>s===1)&&(this.board.splice(e,1),this.board.unshift(Array(this.board_width).fill(0)),e++)}}const x=new V;x.dom.style.left="unset";x.dom.style.right="0";x.showPanel(0);document.body.appendChild(x.dom);const E=document.querySelector("canvas"),P=E.getContext("2d");E.width=R*_;E.height=R*L;P.scale(R,R);const d=new X(_,L);let H=0;function O(i){x.begin(),$(),i>H&&(H=i+F,d.executeTick()),x.end(),window.requestAnimationFrame(O)}function $(){P.fillStyle="#000",P.fillRect(0,0,E.width,E.height),Q(d.board),d.pieces.forEach(i=>Y(i))}function Q(i){P.fillStyle="yellow",i.forEach((e,s)=>{e.forEach((r,t)=>{r===1&&P.fillRect(t,s,1,1)})})}function Y(i){P.fillStyle="red",i.shape.forEach((e,s)=>{e.forEach((r,t)=>{r&&P.fillRect(i.x+t,i.y+s,1,1)})})}function ee(){document.querySelector("#start").hidden=!0;const i=new Audio(N);i.loop=!0,i.play(),O(0),document.addEventListener("keydown",e=>{e.key==="ArrowDown"?d.pieces[1].movePieceDown():e.key==="ArrowLeft"?d.pieces[1].movePieceLeft():e.key==="ArrowRight"?d.pieces[1].movePieceRight():e.key==="ArrowUp"?d.pieces[1].rotatePiece():e.key==="s"?d.pieces[0].movePieceDown():e.key==="a"?d.pieces[0].movePieceLeft():e.key==="d"?d.pieces[0].movePieceRight():e.key==="w"&&d.pieces[0].rotatePiece()})}document.querySelector("#start").addEventListener("click",ee);
