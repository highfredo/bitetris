(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();function I(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var x={exports:{}},R=x.exports,E;function T(){return E||(E=1,function(h,e){(function(t,s){h.exports=s()})(R,function(){var t=function(){function s(c){return o.appendChild(c.dom),c}function i(c){for(var l=0;l<o.children.length;l++)o.children[l].style.display=l===c?"block":"none";r=c}var r=0,o=document.createElement("div");o.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",o.addEventListener("click",function(c){c.preventDefault(),i(++r%o.children.length)},!1);var d=(performance||Date).now(),f=d,n=0,u=s(new t.Panel("FPS","#0ff","#002")),y=s(new t.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var m=s(new t.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:o,addPanel:s,showPanel:i,begin:function(){d=(performance||Date).now()},end:function(){n++;var c=(performance||Date).now();if(y.update(c-d,200),c>f+1e3&&(u.update(1e3*n/(c-f),100),f=c,n=0,m)){var l=performance.memory;m.update(l.usedJSHeapSize/1048576,l.jsHeapSizeLimit/1048576)}return c},update:function(){d=this.end()},domElement:o,setMode:i}};return t.Panel=function(s,i,r){var o=1/0,d=0,f=Math.round,n=f(window.devicePixelRatio||1),u=80*n,y=48*n,m=3*n,c=2*n,l=3*n,p=15*n,g=74*n,v=30*n,w=document.createElement("canvas");w.width=u,w.height=y,w.style.cssText="width:80px;height:48px";var a=w.getContext("2d");return a.font="bold "+9*n+"px Helvetica,Arial,sans-serif",a.textBaseline="top",a.fillStyle=r,a.fillRect(0,0,u,y),a.fillStyle=i,a.fillText(s,m,c),a.fillRect(l,p,g,v),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(l,p,g,v),{dom:w,update:function(P,D){o=Math.min(o,P),d=Math.max(d,P),a.fillStyle=r,a.globalAlpha=1,a.fillRect(0,0,u,p),a.fillStyle=i,a.fillText(f(P)+" "+s+" ("+f(o)+"-"+f(d)+")",m,c),a.drawImage(w,l+n,p,g-n,v,l,p,g-n,v),a.fillRect(l+g-n,p,n,v),a.fillStyle=r,a.globalAlpha=.9,a.fillRect(l+g-n,p,n,f((1-P/D)*v))}}},t})}(x)),x.exports}var _=T();const L=I(_),K="/bitetris/assets/tetris-3uvX0fkN.mp3",M=[[1,1],[1,1]],C=[[1],[1],[1],[1]],O=[[0,1,1],[1,1,0]],z=[[1,1,0],[0,1,1]],B=[[1,0],[1,0],[1,1]],q=[[0,1],[0,1],[1,1]],U=[[1,1,1],[0,1,0]],S=[M,C,O,z,B,q,U];class H{constructor(e,t){this.game=e,this.startPosition=t,this.x=0,this.y=0,this.restart()}movePieceDown(){this.isPositionValid(this.x,this.y+1,this.shape)?this.y++:this.solidifyPiece()}movePieceRight(){this.isPositionValid(this.x+1,this.y,this.shape)&&this.x++}movePieceLeft(){this.isPositionValid(this.x-1,this.y,this.shape)&&this.x--}rotatePiece(){const e=this.shape[0].map((t,s)=>this.shape.map(i=>i[s]).reverse());this.isPositionValid(this.x,this.y,e)&&(this.shape=e)}isPositionValid(e,t,s){var r;if(e<0||e+s[0].length>this.game.board_width||t+s.length>this.game.board_height)return!1;const i=((r=this.game.pieces)==null?void 0:r.filter(o=>o!==this))||[];return!s.some((o,d)=>o.some((f,n)=>f?this.game.board[t+d][e+n]||i.some(u=>u.shape.some((y,m)=>y.some((c,l)=>c&&u.x+l===e+n&&u.y+m===t+d))):!1))}solidifyPiece(){const e=this.x,t=this.y;this.shape.forEach((s,i)=>{s.forEach((r,o)=>{if(!r)return!1;this.game.board[t+i][e+o]=1})}),this.restart()}restart(){this.x=this.startPosition,this.y=0,this.shape=S[Math.floor(Math.random()*S.length)]}}function V(h,e){return Array.from({length:h},()=>new Array(e).fill(0))}class N{constructor(e,t){this.board_width=e,this.board_height=t,this.board=V(e,t),this.pieces=[new H(this,2),new H(this,e-5)]}executeTick(){this.pieces.forEach(e=>e.movePieceDown()),this.clearCompletedRows()}clearCompletedRows(){for(let e=this.board.length-1;e>=0;e--)this.board[e].every(t=>t===1)&&(this.board.splice(e,1),this.board.unshift(Array(this.board_width).fill(0)),e++)}}class F{constructor(e=400,t=100){this.repeatDelay=e,this.repeatInterval=t,this.activeKeys=new Map,this.keyDownHandler=this.keyDownHandler.bind(this),this.keyUpHandler=this.keyUpHandler.bind(this),document.addEventListener("keydown",this.keyDownHandler),document.addEventListener("keyup",this.keyUpHandler)}registerKey(e,t){this.activeKeys.set(e,{callback:t,timeoutId:null,intervalId:null,isPressed:!1})}keyDownHandler(e){const t=this.activeKeys.get(e.key);!t||t.isPressed||(t.isPressed=!0,t.callback(),t.timeoutId=setTimeout(()=>{t.intervalId=setInterval(t.callback,this.repeatInterval)},this.repeatDelay))}keyUpHandler(e){const t=this.activeKeys.get(e.key);t&&(t.isPressed=!1,clearTimeout(t.timeoutId),clearInterval(t.intervalId))}destroy(){document.removeEventListener("keydown",this.keyDownHandler),document.removeEventListener("keyup",this.keyUpHandler)}}const j=400,b=30,k=20;class G{constructor(e){var t;if(this.nextTickTime=0,this.game=new N(b,k),this.keyboard=new F(200,100),this.canvas=document.querySelector(e),this.ctx=(t=this.canvas)==null?void 0:t.getContext("2d"),!this.ctx){const s=`Canvas context not found for selector: ${e}`;throw alert(s),new Error(s)}this.resizeCanvas(),this.stats=new L,this.stats.dom.style.left="unset",this.stats.dom.style.right="0",this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.keyboard.registerKey("w",()=>this.game.pieces[0].rotatePiece()),this.keyboard.registerKey("a",()=>this.game.pieces[0].movePieceLeft()),this.keyboard.registerKey("s",()=>this.game.pieces[0].movePieceDown()),this.keyboard.registerKey("d",()=>this.game.pieces[0].movePieceRight()),this.keyboard.registerKey("ArrowUp",()=>this.game.pieces[1].rotatePiece()),this.keyboard.registerKey("ArrowLeft",()=>this.game.pieces[1].movePieceLeft()),this.keyboard.registerKey("ArrowRight",()=>this.game.pieces[1].movePieceRight()),this.keyboard.registerKey("ArrowDown",()=>this.game.pieces[1].movePieceDown()),this.update(0)}update(e){this.stats.begin(),e>this.nextTickTime&&(this.nextTickTime=e+j,this.game.executeTick()),this.draw(),this.stats.end(),window.requestAnimationFrame(t=>this.update(t))}draw(){this.ctx.fillStyle="#000",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawBoard(this.game.board),this.game.pieces.forEach(e=>this.drawPiece(e))}resizeCanvas(){const e=window.innerWidth,t=window.innerHeight,s=Math.min(e/b,t/k),i=Math.floor(s);this.canvas.width=i*b,this.canvas.height=i*k,this.ctx.scale(i,i)}drawBoard(e){this.ctx.fillStyle="yellow",e.forEach((t,s)=>{t.forEach((i,r)=>{i===1&&this.ctx.fillRect(r,s,1,1)})})}drawPiece(e){this.ctx.fillStyle="red",e.shape.forEach((t,s)=>{t.forEach((i,r)=>{i&&this.ctx.fillRect(e.x+r,e.y+s,1,1)})})}}const A=document.querySelector("#start");A.addEventListener("click",()=>{A.hidden=!0;const h=new Audio(K);h.loop=!0,h.play();const e=new G("canvas");addEventListener("resize",()=>{e.resizeCanvas()})});
